states:
  # ─── decision nodes ─────────────────────────────────────────
  resolver_branch:                   { type: switch,        expression: resolver_match }
  flight_access_switch:              { type: switch,        expression: flight_access }
  first_login_switch:                { type: switch,        expression: first_login }
  login_method_first_switch:         { type: switch,        expression: login_method }
  login_method_returning_switch:     { type: switch,        expression: login_method }
  non_flight_login_method_switch:    { type: switch,        expression: login_method }
  username_type_switch:              { type: switch,        expression: identifier_type }
  domain_flight_access_switch:       { type: switch,        expression: domain_match }
  organization_picker_result_switch: { type: switch,        expression: organization_picker_result }
  non_flight_first_login_switch:     { type: switch,        expression: first_login }
  flight_access_after_domain_switch: { type: switch,        expression: flight_access }


  # ─── action nodes ──────────────────────────────────────────
  resolveUsernameAction:           { type: action }
  verifyTempPasswordAction:        { type: action }
  verifyPasswordAction:            { type: action }
  sendResetEmailAction:            { type: action }
  initiateSSOAction:               { type: action }
  logLoginAttemptAction:           { type: action }
  sendPasswordEmailLinkAction:     { type: action }
  createPasswordAction:            { type: action }
  updatePasswordAction:            { type: action }
  resolvePasswordResetTokenAction: { type: action } # Ensure this exists
  resolvePasswordSetupTokenAction: { type: action } # Ensure this exists

  # ─── sub-flows (re-usable chains) ───────────────────────────
  flight_password_first_login_subflow:
    type: sub-flow
    flow:
      - TempPasswordEntryView
      - verifyTempPasswordAction
      - SetupPasswordView
      - createPasswordAction

  flight_password_returning_subflow:
    type: sub-flow
    flow:
      - PasswordEntryView
      - verifyPasswordAction
      - LoggedInView

  flight_sso_subflow:
    type: sub-flow
    flow:
      - initiateSSOAction
      - SSORedirectView
      - LoggedInView

  non_flight_account_creation_subflow:
    type: sub-flow
    flow:
    - PasswordEmailLinkView
    - sendPasswordEmailLinkAction
    - SetupPasswordView
    - createPasswordAction 
    - LoggedInView

  forgotPw_subflow:
    type: sub-flow
    flow:
      - ForgotPasswordEmailLinkView
      - sendResetEmailAction          # On success, transitions to UpdatePasswordView
      # UpdatePasswordView will initially tell the user to check their email.
      # When the user returns with a token, UpdatePasswordView's UI will trigger token processing.
      - UpdatePasswordView
      - updatePasswordAction          # After successful token validation and password update
      - LoggedInView

  # ─── atomic UI views (each can display errors) ───────────────
  UsernameEntryView:
    type: view
    interface: usernameEntryUI
    error_id: null
    cs_contact: false
    include_context_keys:
      #- username # Example: if you want to pre-fill username if available in context
      #- last_login_attempt_status # Example: if you want to show some status

  TempPasswordEntryView:
    type: view
    interface: tempPasswordEntryUI
    error_id: null
    cs_contact: true
    include_context_keys:
      - identifier
      - company_code  # EG Airline code
      - company_display_name
      - token # This represents the pior state before going to email.

  PasswordEntryView:
    type: view
    interface: passwordEntryUI
    error_id: null
    cs_contact: false
    include_context_keys:
      - identifier
      - company_code  # EG Airline code
      - company_display_name
      - token # This represents the pior state before going to email.

  SetupPasswordView:
    type: view
    interface: setupPasswordUI
    error_id: null
    cs_contact: false
    include_context_keys:
      - identifier
      - email # This could be null if not available.
      - company_code  # EG Airline code
      - company_display_name
      - token # This represents the pior state before going to email.

  UpdatePasswordView:
    type: view
    interface: updatePasswordUI
    error_id: null
    cs_contact: false
    include_context_keys:
      - identifier
      - email # This could be null if not available.
      - company_code  # EG Airline code
      - company_display_name
      - token # This represents the pior state before going to email.

  PasswordEmailLinkView:
    type: view
    interface: passwordEmailLinkUI
    error_id: null
    cs_contact: false
    include_context_keys:
      - identifier
      - email # This could be null if not available.
      - company_code  # EG Airline code
      - company_display_name
      - token # This represents the pior state before going to email.
  
  SSORedirectView:
    type: view
    interface: SSORedirectUI
    error_id: null
    cs_contact: false
    include_context_keys:
      - sso_url
      - token # This represents the prior state before going to SSO.
      - identifier # This is the user identifier for the SSO flow.
      - email # if we have it
      - company_code  # EG Airline code
      - company_display_name
  
  LoggedInView:
    type: view
    interface: loggedInUI
    error_id: null
    cs_contact: false
    include_context_keys:
      - username
      - display_name
      - access_token # whatever is passed today to get all user context
      #- ?

  ForgotPasswordEmailLinkView:
    type: view
    interface: forgotPasswordEmailLinkUI
    error_id: null
    cs_contact: false
    include_context_keys:
      - identifier
      - email # This could be null if not available.
      - company_code  # EG Airline code
      - company_display_name
      - token # This represents the pior state before going to email.
  
  OrganizationPickerView:
    type: view
    interface: organizationPickerUI
    error_id: null
    include_context_keys:
      - company_list # This is a list of companies available 
      - identifier # This is the user identifier for the picker
      - email # This could be null if not available.
      - company_code  # EG Airline code
      - company_display_name
      - token # This represents the prior state before going to organization picker.

